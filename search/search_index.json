{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Home","text":""},{"location":"#mahjax","title":"MahJax","text":"<p>A GPU-Accelerated Japanese Riichi Mahjong Simulator for RL in JAX</p> <p>Japanese Riichi Mahjong is a complex board game that presents a unique combination of imperfect information, multi-player (&gt;2) competition, stochastic dynamics, and high-dimensional inputs. MahJax is highly inspired by Pgx, which offers vectorized simulators for a diverse set of board games. While Pgx includes imperfect information games (such as miniature poker and mahjong), its primary emphasis is on deterministic perfect-information games like Go, Chess, and Shogi. We aim to complement this by offering a full-scale Japanese Riichi Mahjong environment written entirely in JAX.</p>"},{"location":"#overview","title":"Overview","text":"<ul> <li>Vectorized Environment: Fully JIT-compilable and extremely fast (approx. 1.6M steps/sec on 8x A100 GPUs).</li> <li>Beautiful Visualization: Like Pgx, we offer SVG-based game visualization. We also provide an English tile version for those unfamiliar with Chinese characters (Kanji).</li> <li>Playable Interface: A web-based UI allows you to play directly against the agents you train.</li> <li>RL Examples: We provide simple examples for Behavior Cloning and Reinforcement Learning in the <code>examples/</code> directory.</li> </ul> <p>For more details, please refer to the Documentation (TODO links).</p>"},{"location":"#quick-start","title":"Quick Start","text":""},{"location":"#install","title":"Install","text":"<p>Mahjax is available on PyPI. Please make sure that your Python environment has jax and jaxlib installed, depending on your hardware specification. <pre><code>pip install mahjax\n</code></pre></p>"},{"location":"#basic-usage","title":"Basic Usage","text":"<p>We basically follow the Pgx API design.</p> <pre><code>import jax\nimport jax.numpy as jnp\nimport mahjax\n\nbatch_size = 10\nrng = jax.random.PRNGKey(0)\n\n# Initialize environment\nenv = mahjax.make(\n    \"no_red_mahjong\",\n    one_round=True,      # True: Single round, False: Hanchan (East-South game)\n    observe_type=\"dict\", # \"dict\" for Transformer, \"2D\" for CNN\n    order_points=[30, 10, -10, -30] # Final score bonuses (uma)\n)\n\ninit_fn = jax.jit(jax.vmap(env.init))\nstep_fn = jax.jit(jax.vmap(env.step))\nobs_fn = jax.jit(jax.vmap(env.observe))\n\n# Initialize state\nrng, subrng = jax.random.split(rng)\nrngs = jax.random.split(subrng, batch_size)\nstate = init_fn(rngs)\n\n# Step\nrng, subrng = jax.random.split(rng)\nrngs = jax.random.split(subrng, batch_size)\naction = jnp.zeros((batch_size,), dtype=jnp.int8)\nstate = step_fn(state, action, rngs)\n\n# Get observation\nobs = obs_fn(state)\n</code></pre>"},{"location":"#on-rules-of-japanese-riichi-mahjong","title":"On rules of JAPANESE RIICHI Mahjong","text":"<p>There are several variants of Japanese Riichi Mahjong. The most significant distinction is the inclusion of \"Red 5\" tiles (aka-dora).</p> <ul> <li>Current Support: Standard 4-player rules without red tiles.</li> <li>Future Plans: We plan to incorporate popular variants, including Red 5 tiles and 3-player Mahjong (Sanma).</li> </ul>"},{"location":"#user-interface","title":"User interface","text":"<p>MahJax includes a web-based UI (FastAPI + JS) that allows you to play against built-in or custom agents directly in your browser.</p>"},{"location":"#running-the-ui","title":"Running the UI","text":"<p>Install dependencies and start the server: <pre><code>pip install mahjax\nuvicorn mahjax.ui.app:create_app --host 0.0.0.0 --port 8000\n</code></pre> Open http://localhost:8000 to start playing. The default agents are random and rule_based one.</p>"},{"location":"#playing-against-your-agent","title":"Playing Against Your Agent","text":"<p>You can register your trained agent to appear in the UI's agent selector. Create a python script (e.g., <code>my_app.py</code>) and register your agent's act function:</p> <p><pre><code>### my_app.py\nfrom pathlib import Path\nfrom mahjax.ui.app import create_app\n\napp = create_app()\n\n# Load your custom agent\napp.state.manager.registry.load_callable_from_path(\n    file_path=Path(\"path/to/my_agent.py\"),\n    attribute=\"act\", # The function name to call: act(state, rng) -&gt; action_id\n    description=\"My Custom Agent\",\n)\n</code></pre> Run <code>uvicorn my_ui:app --port 8000</code>.</p>"},{"location":"#see-also","title":"See also","text":"<p>Jax based environments - Pgx: Boad game environments such as Go, chess, and Shogi. - Brax: Robotics control. - Gymnax: Popular small scale RL environments such as cartpole or bsuite. - Jumanji: A diverse suite of RL environments (paking, routing, etc). - Craftax: JAX-version of (Crafter + Nethack). - JaxMARL: Multi-agent environments such as Hanabi. - Navix: JAX-version of MiniGrid.</p>"},{"location":"#cite-us","title":"Cite us","text":"<p>Paper comming soon.</p>"},{"location":"#acknowledgements","title":"Acknowledgements","text":"<ul> <li>sotetsuk: For general advice on the development of mahjax based on his experience of developping pgx</li> <li>habara-k: For developing core JAX components such as shanten and Yaku calculation.</li> <li>OkanoShinri: For the initial implementation of MahJax and its SVG visualization.</li> <li>easonyu0203: For advise on PPO implementation in multi-player imperfect information game.</li> </ul>"},{"location":"api/","title":"How to install","text":"<pre><code>pip install mahjax\n</code></pre>"},{"location":"api/#usage","title":"Usage","text":"<p>We follow almost the same api as pgx. Below is the example of usage of mahjax.</p> <pre><code>import jax\nimport jax.numpy as inp\nimport mahjax\nfrom mahjax.action import Action\n\n\nbatch_size = 10\nrng = jax.random.PRNGKey(0)\n\n# Initialize environment and state\nenv = mahjax.make(\n    \"no_red_mahjong\",\n    one_round=True,  # one_round: if False, hanchan game.\n    order_points=[30, 10, -10, -30]  # You can specify the order points by thousands.\n)\nstep_fn = jax.jit(jax.vmap(env.step))\nobs_fn = jax.jit(jax.vmap(env.observe))\n\n# Initialize state\nrng, subrng = jax.random.split(rng)\nrngs = jax.random.split(subrng, batch_size)\nstate = jax.jit(jax.vmap(env.init))(rngs)\n\n# Tsumogiri play\nwhile not state.terminated.all():\n    rng, subrng = jax.random.split(rng, batch_size)\n    obs = obs_fn(state)  # (batch_size, ...) access to the observation.\n    action = jnp.full(mahjax.Action.Tsumogiri, batch_size)\n    state = step_fn(state, action, subrng)\n    reward = state.rewards  # (batch_size, 4) access to the reward.\n</code></pre>"},{"location":"rule/","title":"Supported Mahjong Games","text":"<p>Mahjax currently implements 4-player Japanese Riichi Mahjong variants. To get familiar with the basic rules, please refer to the official rulebook: European Riichi Mahjong Rules (2016, EN).</p> <p>While different variants require different strategies due to their specific rules, we believe the core skills they demand are the same:</p> <ul> <li>Efficient tile and hand evaluation (reasonable combination calculation)</li> <li>Risk management (defense vs. attack)</li> <li>Reading and inferring opponents\u2019 hands</li> </ul> <p>At the moment, Mahjax provides only No red (aka no red dora) variant.</p> <p>The \u201cred\u201d in red mahjong refers to additional dora tiles assigned to 5 tiles (usually 5m, 5p, 5s). This has a large impact on strategy:</p> <ul> <li>In no red mahjong, players must rely more on yaku (hand patterns) to increase score.</li> <li>In red mahjong, players prioritize efficiency to complete a winning hand quickly and must pay closer attention to risk, as the average hand value is higher and the chance of dealing into a high-value RON increases.</li> </ul>"},{"location":"rule/#no-red-mahjong","title":"No Red Mahjong","text":"<p>Although no red dora rules are not as popular in the gaming industry or in existing Mahjong AI research, they are widely played in Japan. Some professional leagues adopting this style include:</p> <ul> <li>Japan Professional Mahjong League</li> <li>Nihon Pro Mahjong</li> <li>SAIKOUISEN</li> </ul> <p>These rules emphasize careful yaku construction and more traditional scoring without the volatility introduced by red dora.</p>"},{"location":"rule/#red-mahjong","title":"Red Mahjong","text":"<p>Red mahjong, especially the rule set used by Tenhou, is currently the most popular variant both in AI research and in commercial online games. We are intended to include this rule in a near furture.</p>"},{"location":"rule/#research-projects-usingtargeting-red-rules","title":"Research Projects Using/Targeting Red Rules","text":"<ul> <li>suphnx: First top-player level mahjong agent trained by Deep RL.</li> <li>mjx: C++ based simulator for tenhou rule.</li> <li>mortal: Rust-based simulator + agent traning code. They also provides the reviewer by their trained agent.</li> <li>naga: Agent reached 10-dan in tenhou. They also provide a service to review the playlog by the agent.</li> </ul>"},{"location":"rule/#games-usingsupporting-red-rules","title":"Games Using/Supporting Red Rules","text":"<ul> <li>Tenhou</li> <li>Mahjong Soul</li> <li>MJ Mahjong</li> </ul> <p>These environments typically feature fast-paced play and high average hand values, making them attractive both for players and for AI research.</p>"},{"location":"rule/#future-pathways","title":"Future Pathways","text":"<p>Planned future extensions for Mahjax include:</p> <ul> <li>Support tenhou rule (Most prioritized).</li> <li>Supporting additional 4-player Japanese Riichi Mahjong rule sets</li> <li>Integrating 3-player Japanese Mahjong rules</li> </ul> <p>These expansions aim to make Mahjax a more comprehensive platform for both Mahjong AI research and gameplay experimentation.</p>"},{"location":"ui/","title":"MahJax UI Guide","text":"<p>MahJax ships with a FastAPI backend and a static JS frontend, so you can battle the bundled <code>mahjax.no_red_mahjong</code> bots in any browser. This guide shows the basics for running the UI in a release setting.</p>"},{"location":"ui/#quickstart","title":"Quickstart","text":"<pre><code>pip install mahjax\nuvicorn mahjax.ui.app:create_app --host 0.0.0.0 --port 8000\n</code></pre> <p>You need Python 3.10+, a matching JAX wheel (install it beforehand), and the runtime deps listed in <code>requirements.txt</code> (<code>fastapi</code>, <code>uvicorn</code>, <code>svgwrite</code>, <code>typing_extensions</code>). Use <code>--reload</code> while developing but turn it off in production.</p>"},{"location":"ui/#core-features","title":"Core Features","text":"<ul> <li>Instant play \u2013 the UI only shows legal actions, so every human move is valid.</li> <li>Bilingual board \u2013 the backend sends both Japanese and English SVGs, and the toggle swaps between them without extra requests.</li> <li>Round insight \u2013 modal summaries list winners, yaku, fan/fu, honba, kyotaku, plus a 50-entry action log.</li> <li>Observer toggle \u2013 hide enemy hands until a non-human Ron/Tsumo or the round end reveals them.</li> <li>Pluggable agents \u2013 register Python callables with <code>AgentRegistry</code> (ships with <code>Rule-based</code> and <code>Random</code>) and they show up right away in <code>/api/agents</code>.</li> </ul>"},{"location":"ui/#using-the-ui","title":"Using the UI","text":"<ul> <li>Header controls: choose the agent, match length (<code>hanchan</code> or <code>one_round</code>), seat (fixed or random), optional seed, display names, AI delay in ms, and whether to hide opponent hands. The Start and End buttons spawn or delete sessions.</li> <li>Board &amp; actions: the human seat stays at the bottom. Tile buttons map to discard IDs (<code>0\u201333</code>). Extra buttons cover riichi, tsumo, ron, pass, kan, pon, and chi. If only a dummy action remains, an \u201cAdvance\u201d button sends <code>Action.DUMMY</code>.</li> <li>Scoreboard &amp; log: scores use turn order relative to the human and display current deltas. Logs show discards, calls, and declarations.</li> <li>Round summaries: when <code>_terminated_round</code> flips on, the server returns <code>roundSummary</code>, and the UI shows standings plus winner info. Press \u201cNext Round,\u201d or \u201cEnd Game\u201d if <code>isGameEnd</code> is true.</li> </ul>"},{"location":"ui/#extending-agents-ui","title":"Extending Agents &amp; UI","text":"<ul> <li>Custom Agents: Register new agents using <code>AgentRegistry</code>. Your agent must be a callable accepting <code>(state, rng)</code> and returning a valid action ID.</li> <li>Frontend Customization: Edit <code>mahjax/ui/static/app.js</code> and <code>styles.css</code> directly. No Node.js build step is required.</li> </ul>"},{"location":"ui/#adding-custom-agents","title":"Adding Custom Agents","text":"<p>To add your own agent to the dropdown menu, create a wrapper script that registers your agent function before starting the app.</p> <ol> <li>Define your agent: Create a function <code>(state, rng) -&gt; int</code>.</li> <li>Register and Run:</li> </ol> <pre><code># my_ui_app.py\nfrom pathlib import Path\nfrom mahjax.ui.app import create_app\n\napp = create_app()\n\n# Register your agent implementation\napp.state.manager.registry.load_callable_from_path(\n    file_path=Path(\"path/to/my_agent_impl.py\"),\n    attribute=\"act\",  # Function name in your file\n    description=\"My Custom Agent\"\n)\n</code></pre> <ol> <li>Run <code>uvicorn my_ui_app:app --host 0.0.0.0 --port 8000</code>. The agent now appears in <code>/api/agents</code>, so the UI selector lists it right away.</li> </ol>"},{"location":"ui/#troubleshooting-limits","title":"Troubleshooting &amp; Limits","text":"<ul> <li>Blank board? Confirm <code>mahjax/ui/static</code> exists and FastAPI mounts it. Check the console for <code>/static</code> 404 errors.</li> <li>Buttons stuck? The game is in <code>awaiting_ai</code> or <code>round_end</code>. Wait for auto-play or dismiss the summary modal.</li> <li>AI idle? Check <code>ai_delay_ms</code> and watch <code>/api/game/{id}/auto</code> responses.</li> <li>Hidden hands never reveal? Clear the checkbox or note that only non-human wins unhide opponents.</li> <li>The current build only supports 4-player Riichi without red dora and runs without auth. Protect it behind a reverse proxy or VPN before exposing it to the internet.</li> </ul>"}]}